# 接口文档（DuckTodo）

说明：
- 文档按控制器分组列出接口，包含路径、方法、权限、请求参数与返回类型。
- 任务域实际前缀为`/apitasks`（实现），其余模块为`/api/...`。
- 所有接口统一返回封装类型`R<T>`，失败时包含错误消息与标准HTTP语义（401/400/404/500）。注意：权限相关错误统一使用400状态码，禁止使用403。
- 鉴权：除`/api/base/**`与文档路径外，其余接口均需携带`Authorization: Bearer <token>`。
- 文档入口：`/doc.html`；OpenAPI：`/v3/api-docs`；Swagger UI：`/swagger-ui/index.html`。

## Base（基础）
- 接口：`GET /api/base/health`
  - 作用：系统健康检查，返回应用信息、服务器时间与对象存储连通性。
  - 权限：公开
  - 入参：无
  - 正确返回：`R<Map<String,Object>>`
    - 字段：`status`、`appName`、`version`、`serverTime`、`timestamp`、`storagePath`
    - 出参样例：
      ```json
      {
        "success": true,
        "code": 200,
        "message": "OK",
        "data": {
          "status": "UP",
          "appName": "DuckTodo",
          "version": "0.0.1-SNAPSHOT",
          "serverTime": "2025-12-24 12:34:56",
          "timestamp": 1766590000000,
          "storagePath": "http://minio:9000/ducktodo/"
        },
        "timestamp": 1766590000000
      }
      ```
  - 错误返回：无（若存储不可用，`storagePath` 字段为 `"MinIO Config Error"`）

- 接口：`POST /api/base/login`
  - 作用：基于用户名或邮箱进行认证，成功返回 JWT 与用户信息。
  - 权限：公开
  - 入参：`LoginRequest`
    - `userName`（可选，与 `userEmail` 二选一）
    - `userEmail`（可选，与 `userName` 二选一）
    - `userPassword`（必填）
    - 入参样例：
      ```json
      {
        "userName": "alice",
        "userPassword": "myp@ssw0rd"
      }
      ```
  - 正确返回：`R<LoginResponse>`
    - 字段：`token`、`userId`、`userName`、`userEmail`、`userPhone`、`userSex`、`userAvatar`、`userRemark`、`lastLoginTime`、`createTime`
    - 出参样例：
      ```json
      {
        "success": true,
        "code": 200,
        "message": "OK",
        "data": {
          "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
          "userId": "4e2b3c8a-0f6d-4f4d-98b0-123456789abc",
          "userName": "alice",
          "userEmail": "alice@example.com",
          "userPhone": "13800000000",
          "userSex": 1,
          "userAvatar": "http://minio:9000/ducktodo/avatars/alice.png",
          "userRemark": null,
          "lastLoginTime": "2025-12-24T12:34:56",
          "createTime": "2025-12-01T08:00:00"
        },
        "timestamp": 1766590000000
      }
      ```
  - 错误返回：
    - `R.fail("缺少用户名或邮箱")`
    - `R.fail("缺少密码")`
    - `R.fail("用户不存在或密码错误")`
    - 错误样例：
      ```json
      {
        "success": false,
        "code": 400,
        "message": "缺少密码",
        "timestamp": 1766590000000
      }
      ```

- 接口：`POST /api/base/register`
  - 作用：创建用户并初始化默认任务族，成功后返回 JWT 与用户信息。
  - 权限：公开
  - 入参：`RegisterRequest`
    - `userName`（必填）
    - `userEmail`（必填，邮箱格式）
    - `userPassword`（必填，至少 8 位且包含英文）
    - `userPhone`（必填，11 位数字）
    - `userSex`（必填，0-女，1-男，2-保密）
    - 入参样例：
      ```json
      {
        "userName": "alice",
        "userEmail": "alice@example.com",
        "userPassword": "MyStrongPass1",
        "userPhone": "13800000000",
        "userSex": 1
      }
      ```
  - 正确返回：`R<LoginResponse>`（同登录）
    - 出参样例：同“登录”接口
  - 错误返回：
    - 基础校验：`用户名不能为空`、`邮箱不能为空`、`密码不能为空`、`手机号不能为空`、`性别不能为空`
    - 格式校验：`邮箱格式不正确`、`密码需8位以上且包含英文`、`手机号格式不正确`、`性别参数无效`
    - 唯一性：`用户名已存在`、`邮箱已存在`、`手机号已存在`
    - 内部错误：`注册失败：保存用户信息失败`、`注册失败：保存安全信息失败`、`注册失败：默认任务族创建失败`、`注册失败：默认任务族关系创建失败`
    - 错误样例：
      ```json
      {
        "success": false,
        "code": 400,
        "message": "邮箱已存在",
        "timestamp": 1766590000000
      }
      ```

- 接口：`POST /api/base/logout`
  - 作用：记录登出审计并提示前端丢弃令牌（JWT 无状态）。
  - 权限：公开
  - 入参：无
  - 正确返回：`R<String>`
    - 出参样例：
      ```json
      {
        "success": true,
        "code": 200,
        "message": "已成功登出",
        "timestamp": 1766590000000
      }
      ```
  - 错误返回：无

## User（用户）
### 获取当前用户信息
- 接口请求方式与地址：GET `/api/user/me`（top.smartduck.ducktodo.controller.UserController:77）
- 接口作用简介：获取当前登录用户的最新资料。
- 接口权限限制：登录用户（仅本人）
- 接口入参：无
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "OK",
    "data": {
      "userId": "12345678-1234-1234-1234-1234567890ab",
      "userName": "alice",
      "userEmail": "alice@example.com",
      "userPhone": "13800000000",
      "userSex": 1,
      "userAvatar": "http://minio:9000/ducktodo/avatars/alice.png",
      "userRemark": "Hello",
      "lastLoginTime": "2025-12-24T12:00:00",
      "isDelete": 0,
      "createTime": "2025-12-01T08:00:00",
      "updateTime": "2025-12-24T12:00:00"
    },
    "timestamp": 1766590000000
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`用户ID无效`
  - 404 未找到：`用户不存在`

### 根据用户ID获取用户信息
- 接口请求方式与地址：GET `/api/user/{userId}`（top.smartduck.ducktodo.controller.UserController:106）
- 接口作用简介：查询指定用户的基础资料。
- 接口权限限制：登录用户
- 接口入参：路径参数 `userId`
- 入参样例：`/api/user/12345678-1234-1234-1234-1234567890ab`
- 接口正确返回时，出参以及出参样例：同“获取当前用户信息”的 `User` 结构
- 接口错误返回时的提示内容：
  - 400 参数错误：`缺少用户ID`
  - 404 未找到：`用户不存在`

### 获取当前用户的访问密钥
- 接口请求方式与地址：GET `/api/user/me/access-keys`（top.smartduck.ducktodo.controller.UserController:131）
- 接口作用简介：获取当前用户的 API 访问密钥（AK/SK）。
- 接口权限限制：登录用户（仅本人）
- 接口入参：无
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "OK",
    "data": {
      "userAccesskey": "AK123456",
      "userSecretkey": "SKabcdefg"
    },
    "timestamp": 1766590000000
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`用户安全信息不存在`

### 更新当前用户的访问密钥
- 接口请求方式与地址：PUT `/api/user/me/access-keys`（top.smartduck.ducktodo.controller.UserController:164）
- 接口作用简介：更新或设置当前用户的 AK/SK。
- 接口权限限制：登录用户（仅本人）
- 接口入参：请求体 `AccessKeyRequest`
  - 字段：`userAccesskey`（可选），`userSecretkey`（可选）
  - 入参样例：
    ```json
    {
      "userAccesskey": "AK987654",
      "userSecretkey": "SKzzzzzz"
    }
    ```
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "密钥更新成功",
    "data": {
      "userAccesskey": "AK987654",
      "userSecretkey": "SKzzzzzz"
    },
    "timestamp": 1766590000000
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`用户安全信息不存在`、`AccessKey 不能为空`、`SecretKey 不能为空`
  - 500 服务器错误：`更新密钥失败`

### 删除当前用户的访问密钥
- 接口请求方式与地址：DELETE `/api/user/me/access-keys`（top.smartduck.ducktodo.controller.UserController:216）
- 接口作用简介：清空 AK/SK，禁用密钥访问。
- 接口权限限制：登录用户（仅本人）
- 接口入参：无
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "密钥已删除",
    "data": {
      "userAccesskey": null,
      "userSecretkey": null
    },
    "timestamp": 1766590000000
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`用户安全信息不存在`
  - 500 服务器错误：`删除密钥失败`

### 修改当前用户的个人信息
- 接口请求方式与地址：PUT `/api/user/me`（top.smartduck.ducktodo.controller.UserController:261）
- 接口作用简介：更新邮箱、手机号、性别、备注等基础资料。
- 接口权限限制：登录用户（仅本人）
- 接口入参：请求体 `User`（仅以下字段生效）
  - `userEmail`（可选，邮箱格式）
  - `userPhone`（可选，11 位数字）
  - `userSex`（可选，0-女，1-男，2-保密）
  - `userRemark`（可选）
- 入参样例：
  ```json
  {
    "userEmail": "alice.new@example.com",
    "userPhone": "13800000001",
    "userSex": 2,
    "userRemark": "update"
  }
  ```
- 接口正确返回时，出参以及出参样例：返回更新后的 `User`（同“获取当前用户信息”结构），`message` 为 `更新成功`
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 404 未找到：`用户不存在`
  - 400 参数错误：`邮箱格式不正确`、`手机号格式不正确`、`性别参数无效 (0-女, 1-男, 2-保密)`、`邮箱已存在`、`手机号已存在`
  - 500 服务器错误：`更新失败`

### 修改当前用户密码
- 接口请求方式与地址：PUT `/api/user/me/password`（top.smartduck.ducktodo.controller.UserController:361）
- 接口作用简介：验证原密码并更新为新密码（Argon2 加密）。
- 接口权限限制：登录用户（仅本人）
- 接口入参：请求体 `UpdatePasswordRequest`
  - `originalPassword`（必填）
  - `newPassword`（必填，至少 6 位）
- 入参样例：
  ```json
  {
    "originalPassword": "oldPass123",
    "newPassword": "newPass456"
  }
  ```
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "OK",
    "data": "更改成功",
    "timestamp": 1766590000000
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`用户安全信息不存在`、`原始密码不能为空`、`新密码不能为空`、`新密码至少 6 位`、`原始密码错误`
  - 500 服务器错误：`密码更新失败`

### 更新当前用户头像
- 接口请求方式与地址：POST `/api/user/me/avatar`（multipart/form-data）（top.smartduck.ducktodo.controller.UserController:423）
- 接口作用简介：上传图片到对象存储，更新用户头像 URL（自动清理旧头像）。
- 接口权限限制：登录用户（仅本人）
- 接口入参：表单字段
  - `file`（必填，图片类型，≤ 1MB）
- 入参样例：`file=@/path/to/avatar.png`
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "头像更新成功",
    "data": {
      "userId": "12345678-1234-1234-1234-1234567890ab",
      "userAvatar": "http://minio:9000/ducktodo/avatars/12345678-...-avatar.png"
    },
    "timestamp": 1766590000000
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 404 未找到：`用户不存在`
  - 400 参数错误：`文件为空`、`仅支持图片类型`、`文件大小不得超过1MB`
  - 500 服务器错误：`头像更新失败`、`上传失败: <错误信息>`

### 分页查询用户列表
- 接口请求方式与地址：GET `/api/user`（top.smartduck.ducktodo.controller.UserController:511）
- 接口作用简介：支持用户名、邮箱、手机号模糊搜索，按用户名升序。
- 接口权限限制：登录用户
- 接口入参：查询参数
  - `page`（默认 1）
  - `size`（默认 10，最大 100）
  - `userName`（可选）
  - `userEmail`（可选）
  - `userPhone`（可选）
- 入参样例：`/api/user?page=1&size=10&userName=ali`
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "查询成功",
    "data": {
      "records": [
        {
          "userId": "12345678-1234-1234-1234-1234567890ab",
          "userName": "alice",
          "userEmail": "alice@example.com",
          "userPhone": "13800000000",
          "userSex": 1,
          "userAvatar": "http://minio:9000/ducktodo/avatars/alice.png",
          "userRemark": "Hello",
          "lastLoginTime": "2025-12-24T12:00:00"
        }
      ],
      "total": 1,
      "pages": 1,
      "current": 1,
      "size": 10
    },
    "timestamp": 1766590000000
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

## Team（团队）
### 创建团队
- 接口请求方式与地址：POST `/api/teams`（top.smartduck.ducktodo.controller.TeamController:109）
- 接口作用简介：创建团队，自动初始化所属任务族与成员关系，可同时邀请成员。
- 接口权限限制：登录用户
- 接口入参：请求体 `CreateTeamRequest`
  - `teamName`（必填，≥2）
  - `teamDescription`（可选）
  - `teamAvatar`（可选，存储路径）
  - `teamStatus`（可选，`0`禁用/`1`进行中/`2`已结束；默认`1`）
  - `invitedMemberList[{userId, memberRole}]`（可选，角色仅支持`manager|member`）
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "创建成功",
    "data": {
      "teamId": "c9f1c8b2-...-b12d",
      "teamName": "研发一组",
      "teamDescription": "后端与前端联合项目",
      "teamAvatar": "",
      "teamStatus": 1,
      "isDelete": 0,
      "createTime": "2025-12-24T12:00:00",
      "updateTime": "2025-12-24T12:00:00"
    },
    "timestamp": 1766590000000
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`团队名不能为空`、`团队名称至少 2 位`、`非法团队状态`
  - 400 业务冲突：`团队名称已经存在`
  - 500 服务器错误：`创建团队失败`、`创建团队所属任务族失败`、`创建团队与所有者关系失败`、`创建团队所属任务族与所有者关系失败`、`创建团队与被邀请成员的邀请关系失败`

### 邀请成员
- 接口请求方式与地址：POST `/api/teams/{teamId}/members`（top.smartduck.ducktodo.controller.TeamController:261）
- 接口作用简介：邀请指定用户加入团队，支持设置为`manager`或`member`。
- 接口权限限制：`owner|manager`
- 接口入参：
  - 路径参数：`teamId`
  - 请求体：`TeamUserRelation`（仅读取`userId`、`userRole`）
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "邀请成功",
    "data": {
      "teamUserRelationId": "95a...e1",
      "teamId": "c9f1c8b2-...-b12d",
      "userId": "user-123",
      "userRole": 2,
      "userStatus": 2,
      "teamIndex": 0,
      "teamColor": "#6AAEFF",
      "joinTime": "2025-12-24T12:00:00",
      "updateTime": "2025-12-24T12:00:00",
      "isDelete": 0
    }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少 teamId 或 userId`、`角色仅支持 manager 或 member`
  - 400 权限不足：`非团队成员无法邀请`、`没有邀请权限`
  - 404 未找到：`用户不存在`、`团队不存在`、`未找到邀请记录`
  - 400 业务冲突：`该用户已是团队成员`
  - 500 服务器错误：`邀请失败`、`重新邀请失败`、`更新邀请失败`

### 删除团队
- 接口请求方式与地址：DELETE `/api/teams/{teamId}`（top.smartduck.ducktodo.controller.TeamController:365）
- 接口作用简介：级联逻辑删除团队及其关联数据（任务族、任务、成员、附件、图谱节点与边）。
- 接口权限限制：仅`owner`
- 接口入参：路径参数 `teamId`
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "删除成功" }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 404 未找到：`团队不存在`
  - 400 权限不足：`仅团队所有者可删除团队`
  - 500 服务器错误：`删除任务族成员关系失败`、`删除任务链失败`、`删除任务节点失败`、`删除任务协助者关系失败`、`删除任务附件失败`、`删除子任务失败`、`删除任务失败`、`删除任务族失败`、`删除团队成员关系失败`、`删除团队失败`

### 退出团队（本人）
- 接口请求方式与地址：DELETE `/api/teams/{teamId}/members/me`（top.smartduck.ducktodo.controller.TeamController:490）
- 接口作用简介：当前用户退出目标团队（所有者不可退出），并清除其在团队所属任务族的关系。
- 接口权限限制：团队成员（禁止所有者）
- 接口入参：路径参数 `teamId`
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "退出成功" }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`参数缺失: teamId`
  - 404 未找到：`未找到该团队的成员关系或未激活`
  - 400 权限不足：`团队所有者不可退出团队`
  - 500 服务器错误：`删除团队成员关系失败`、`删除任务族成员关系失败`

### 删除团队成员
- 接口请求方式与地址：DELETE `/api/teams/{teamId}/members/{userId}`（top.smartduck.ducktodo.controller.TeamController:561）
- 接口作用简介：删除指定成员，自动清理其在团队所属任务族的关系。
- 接口权限限制：
  - 删除他人：`owner|manager`允许，`member`禁止；不可删除团队所有者
  - 删除自身：所有者禁止；其他成员可通过“退出团队”接口
- 接口入参：路径参数 `teamId`、`userId`
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "删除成功" }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少必要参数: teamId 或 userId`
  - 400 权限不足：`当前用户不属于该团队或未激活`、`仅所有者或管理员可删除他人`、`不可删除团队所有者`、`团队所有者不可删除自身`
  - 500 服务器错误：`删除团队成员关系失败`、`删除任务族成员关系失败`

### 修改团队信息
- 接口请求方式与地址：PUT `/api/teams`（top.smartduck.ducktodo.controller.TeamController:640）
- 接口作用简介：按需更新团队名称、描述或状态，仅当字段变更时更新。
- 接口权限限制：仅`owner`
- 接口入参：请求体 `Team`
  - `teamId`（必填）
  - `teamName`（可选，≥2，唯一）
  - `teamDescription`（可选）
  - `teamStatus`（可选，合法枚举：`0|1|2`）
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "更新成功",
    "data": { "teamId": "c9f1c8b2-...-b12d", "teamName": "研发一组", "teamStatus": 1 }
  }
  ```
  或
  ```json
  { "success": true, "code": 200, "message": "无变更" }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少请求体`、`缺少团队ID`、`团队名称至少 2 位`、`非法团队状态`
  - 404 未找到：`团队不存在`
  - 400 业务冲突：`团队名称已经存在`
  - 500 服务器错误：`更新失败`

### 接受加入邀请（本人）
- 接口请求方式与地址：PUT `/api/teams/{teamId}/invites/me/accept`（top.smartduck.ducktodo.controller.TeamController:732）
- 接口作用简介：将当前用户在该团队的成员状态从“邀请中”更新为“正常”，并补充默认任务族关系。
- 接口权限限制：受邀用户（当前用户）
- 接口入参：路径参数 `teamId`
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "已接受" }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`参数缺失: teamId`
  - 404 未找到：`团队不存在`、`未找到邀请记录`
  - 400 权限不足：`当前状态不可接受邀请`
  - 500 服务器错误：`接受失败`

### 拒绝加入邀请（本人）
- 接口请求方式与地址：PUT `/api/teams/{teamId}/invites/me/reject`（top.smartduck.ducktodo.controller.TeamController:812）
- 接口作用简介：将当前用户在该团队的成员状态从“邀请中”更新为“已拒绝”。
- 接口权限限制：受邀用户（当前用户）
- 接口入参：路径参数 `teamId`
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "已拒绝" }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`参数缺失: teamId`
  - 404 未找到：`团队不存在`、`未找到邀请记录`
  - 400 权限不足：`当前状态不可拒绝邀请`
  - 500 服务器错误：`拒绝失败`

### 修改成员角色
- 接口请求方式与地址：PUT `/api/teams/{teamId}/members/{userId}/role`（top.smartduck.ducktodo.controller.TeamController:875）
- 接口作用简介：在团队内修改目标用户的角色，仅允许设置为`manager`或`member`。
- 接口权限限制：`owner|manager`（不可修改自身；禁止设为`owner`）
- 接口入参：
  - 路径参数：`teamId`、`userId`
  - 请求体：`TeamUserRelation`（仅读取`userRole`）
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "修改成功",
    "data": { "teamId": "c9f1c8b2-...-b12d", "userId": "user-123", "userRole": 1 }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`角色参数缺失`、`角色仅支持 manager 或 member`、`禁止设为 owner`
  - 404 未找到：`成员不存在或未激活`
  - 400 权限不足：`没有修改权限`、`不可修改自身角色`
  - 500 服务器错误：`更新失败`

### 交换本人团队排序
- 接口请求方式与地址：PUT `/api/teams/order`（top.smartduck.ducktodo.controller.TeamController:938）
- 接口作用简介：交换本人在两个团队的显示排序。
- 接口权限限制：需为两个目标团队的正常成员
- 接口入参：请求体 `SwapMyTeamOrderRequest`（`teamIdA`、`teamIdB`）
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "交换成功",
    "data": [
      { "teamId": "A", "teamIndex": 3, "teamColor": "#6AAEFF" },
      { "teamId": "B", "teamIndex": 2, "teamColor": "#6AAEFF" }
    ]
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`参数错误`、`排序值禁止一致`
  - 404 未找到：`未找到成员关系`
  - 500 服务器错误：`更新失败`

### 修改本人在团队的颜色
- 接口请求方式与地址：PUT `/api/teams/{teamId}/members/me/color`（top.smartduck.ducktodo.controller.TeamController:1028）
- 接口作用简介：更新本人在该团队的显示颜色。
- 接口权限限制：团队正常成员（本人）
- 接口入参：
  - 路径参数：`teamId`
  - 请求体：`TeamUserRelation`（仅读取`teamColor`，格式`#xxxxxx`）
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "颜色已更新",
    "data": { "teamId": "c9f1c8b2-...-b12d", "teamColor": "#6AAEFF" }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少团队ID`、`颜色格式无效，需为 #xxxxxx（6位十六进制）`
  - 404 未找到：`成员不存在或未激活`
  - 500 服务器错误：`更新失败`

### 本人的被邀请团队分页
- 接口请求方式与地址：GET `/api/teams/me/invites`（top.smartduck.ducktodo.controller.TeamController:1119）
- 接口作用简介：分页查询本人收到的团队邀请，支持邀请状态过滤与团队名模糊匹配。
- 接口权限限制：登录用户（仅本人）
- 接口入参：查询参数
  - `page`（默认 1）
  - `size`（默认 10）
  - `memberStatus`（取值`1|2|3`；默认`2`=邀请中）
  - `teamName`（可选，模糊）
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "查询成功",
    "data": {
      "records": [
        { "teamId": "c9f1c8b2-...-b12d", "teamName": "研发一组", "memberStatus": 2 }
      ],
      "total": 1,
      "pages": 1
    }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

### 查询本人相关团队
- 接口请求方式与地址：GET `/api/teams/me`（top.smartduck.ducktodo.controller.TeamController:1220）
- 接口作用简介：返回与本人有关且处于进行中的团队列表，按个人排序升序。
- 接口权限限制：登录用户（仅本人）
- 接口入参：无
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "查询成功",
    "data": [
      { "teamId": "c9f1c8b2-...-b12d", "teamName": "研发一组", "teamStatus": 1, "teamIndex": 1 }
    ]
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

### 查询团队基础信息
- 接口请求方式与地址：GET `/api/teams/{teamId}`（top.smartduck.ducktodo.controller.TeamController:1273）
- 接口作用简介：查询团队基础信息，需为该团队正常成员。
- 接口权限限制：团队正常成员
- 接口入参：路径参数 `teamId`
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "查询成功",
    "data": {
      "teamId": "c9f1c8b2-...-b12d",
      "teamName": "研发一组",
      "teamDescription": "后端与前端联合项目",
      "teamAvatar": "",
      "teamStatus": 1
    }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少团队ID`
  - 400 权限不足：`仅团队成员可查看`
  - 404 未找到：`团队不存在`

### 团队数据大屏（占位）
- 接口请求方式与地址：GET `/api/teams/{teamId}/dashboard`（top.smartduck.ducktodo.controller.TeamController:1304）
- 接口作用简介：骨架占位，后续将展示团队统计与图谱摘要。
- 接口权限限制：团队正常成员
- 接口入参：路径参数 `teamId`
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "TODO", "data": "查询成功，当前功能暂未开发" }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少团队ID`
  - 400 权限不足：`仅团队成员可查看`

### 团队成员分页
- 接口请求方式与地址：GET `/api/teams/{teamId}/members`（top.smartduck.ducktodo.controller.TeamController:1338）
- 接口作用简介：分页查询团队成员，支持用户名模糊、角色与邀请状态筛选。
- 接口权限限制：团队正常成员
- 接口入参：
  - 路径参数：`teamId`
  - 查询参数：`page`（默认1）、`size`（默认10，最大100）、`userName`（模糊）、`memberRole(owner|manager|member|0|1|2)`、`invited(true|false)`
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "查询成功",
    "data": {
      "records": [
        {
          "teamUserRelationshipId": "rel-123",
          "teamId": "c9f1c8b2-...-b12d",
          "memberRole": 2,
          "memberStatus": 1,
          "teamIndex": 1,
          "teamColor": "#6AAEFF",
          "joinTime": "2025-12-24T12:00:00",
          "updateTime": "2025-12-24T12:00:00",
          "userId": "user-123",
          "userName": "alice",
          "userEmail": "alice@example.com",
          "userPhone": "13800000000",
          "userSex": 1,
          "userAvatar": "http://minio:9000/ducktodo/avatars/alice.png",
          "userRemark": "Hello",
          "lastLoginTime": "2025-12-24T08:00:00"
        }
      ],
      "total": 1,
      "pages": 1
    }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少团队ID`、`成员角色参数不合法`
  - 400 权限不足：`无权限查看该团队成员`

## TaskGroup（任务族）
- `POST /api/taskgroups`
  - 权限：登录用户（仅本人创建私有任务族）
  - 请求体：`TaskGroup`（`groupName`≥2、`groupDescription`、`groupStatus`默认1）
  - 接口正确返回时，出参以及出参样例：
    ```json
    {
      "success": true,
      "code": 200,
      "message": "创建成功",
      "data": {
        "taskGroupId": "tg-123",
        "teamId": "",
        "groupName": "我的任务族",
        "groupDescription": "说明",
        "groupStatus": 1,
        "isDelete": 0,
        "createTime": "2025-12-25T12:00:00",
        "updateTime": "2025-12-25T12:00:00"
      }
    }
    ```
  - 接口错误返回时的提示内容：
    - 401 未授权：`未能识别当前用户`
    - 400 参数错误：`未找到具体任务族名称或任务族名称必须大于两个字符`
    - 500 服务器错误：`创建私人任务族失败`、`创建团队所属任务族与所有者关系失败`
- `PUT /api/taskgroups`
  - 权限：仅创建者（私有任务族）
  - 请求体：`TaskGroup`（需含`taskGroupId`，更新`groupName`≥2、`groupDescription`、`groupStatus`）
  - 接口正确返回时，出参以及出参样例：
    ```json
    {
      "success": true,
      "code": 200,
      "message": "更新成功",
      "data": {
        "taskGroupId": "tg-123",
        "teamId": "",
        "groupName": "重命名后的任务族",
        "groupDescription": "更新说明",
        "groupStatus": 1,
        "isDelete": 0,
        "createTime": "2025-12-24T12:00:00",
        "updateTime": "2025-12-25T12:05:00"
      }
    }
    ```
  - 接口错误返回时的提示内容：
    - 401 未授权：`未能识别当前用户`
    - 400 参数错误：`需提供 taskGroupId`、`任务族名称必须大于等于两个字符`
    - 404 未找到：`任务族不存在`
    - 400 权限不足：`仅允许更新私有任务族（无 teamId）`、`仅任务族创建者可更新任务族`
    - 500 服务器错误：`更新任务族失败`
- `DELETE /api/taskgroups/{taskGroupId}`
  - 权限：仅创建者（私有任务族，默认任务族不可删除）
  - 路径：`taskGroupId`
  - 接口正确返回时，出参以及出参样例：
    ```json
    { "success": true, "code": 200, "message": "删除成功", "data": null }
    ```
  - 接口错误返回时的提示内容：
    - 401 未授权：`未能识别当前用户`
    - 404 未找到：`任务族不存在`
    - 400 权限不足：`仅允许删除私有任务族（无 teamId）`、`默认任务族不可删除`、`仅任务族创建者可删除任务族`
    - 500 服务器错误：`删除任务链失败`、`删除任务节点失败`、`删除任务与用户关系失败`、`删除任务文件失败`、`删除子任务失败`、`删除任务失败`、`删除任务族用户关系失败`、`删除任务族失败`
- `PUT /api/taskgroups/order`
  - 权限：需为两个目标任务族的正常成员（owner/manager/member）
  - 请求体：`SwapMyTaskGroupOrderRequest`（`taskGroupIdA`、`taskGroupIdB`，两者不同）
  - 接口正确返回时，出参以及出参样例：
    ```json
    {
      "success": true,
      "code": 200,
      "message": "交换成功",
      "data": [
        {
          "taskGroupId": "tg-A",
          "teamId": "",
          "groupName": "A",
          "groupDescription": null,
          "groupStatus": 1,
          "userRole": 2,
          "groupAlias": "A",
          "groupColor": "#6AAEFF",
          "groupIndex": 1,
          "joinTime": "2025-12-24T12:00:00",
          "updateTime": "2025-12-25T12:06:00",
          "isPrivate": true,
          "teamName": null,
          "teamDescription": null,
          "teamAvatar": null,
          "teamStatus": null
        }
      ]
    }
    ```
  - 接口错误返回时的提示内容：
    - 401 未授权：`未能识别当前用户`
    - 400 参数错误：`需提供两个不同的任务族ID`
    - 404 未找到：`排序交换失败：至少一个任务族不存在或未与当前用户建立关系`
    - 500 服务器错误：`交换排序失败`
- `PUT /api/taskgroups/{taskGroupId}/members/me/color`
  - 权限：任务族关系成员（本人）
  - 路径：`taskGroupId`
  - 请求体：`TaskGroupUserRelation`（`groupColor`，格式`#xxxxxx`）
  - 接口正确返回时，出参以及出参样例：
    ```json
    {
      "success": true,
      "code": 200,
      "message": "颜色已更新",
      "data": {
        "taskGroupId": "tg-123",
        "teamId": "",
        "groupName": "我的任务族",
        "groupDescription": "说明",
        "groupStatus": 1,
        "userRole": 2,
        "groupAlias": "我的任务族",
        "groupColor": "#6AAEFF",
        "groupIndex": 1,
        "joinTime": "2025-12-24T12:00:00",
        "updateTime": "2025-12-25T12:07:00",
        "isPrivate": true,
        "teamName": null,
        "teamDescription": null,
        "teamAvatar": null,
        "teamStatus": null
      }
    }
    ```
  - 接口错误返回时的提示内容：
    - 401 未授权：`未能识别当前用户`
    - 400 参数错误：`颜色格式无效，需为 #xxxxxx（6位十六进制）`、`需提供 taskGroupId`
    - 404 未找到：`未找到该任务族的用户关系`
    - 500 服务器错误：`颜色更新失败`
- `PUT /api/taskgroups/{taskGroupId}/members/me/alias`
  - 权限：任务族关系成员（本人）
  - 路径：`taskGroupId`
  - 请求体：`TaskGroupUserRelation`（`groupAlias`，非空，≤64）
  - 接口正确返回时，出参以及出参样例：
    ```json
    {
      "success": true,
      "code": 200,
      "message": "别名已更新",
      "data": {
        "taskGroupId": "tg-123",
        "teamId": "",
        "groupName": "我的任务族",
        "groupDescription": "说明",
        "groupStatus": 1,
        "userRole": 2,
        "groupAlias": "自定义别名",
        "groupColor": "#6AAEFF",
        "groupIndex": 1,
        "joinTime": "2025-12-24T12:00:00",
        "updateTime": "2025-12-25T12:08:00",
        "isPrivate": true,
        "teamName": null,
        "teamDescription": null,
        "teamAvatar": null,
        "teamStatus": null
      }
    }
    ```
  - 接口错误返回时的提示内容：
    - 401 未授权：`未能识别当前用户`
    - 400 参数错误：`需提供 taskGroupId`、`别名不能为空`、`别名长度过长（最多64字符）`
    - 404 未找到：`未找到该任务族的用户关系`
    - 500 服务器错误：`别名更新失败`
- `GET /api/taskgroups/me`
  - 权限：登录用户（仅本人）
  - 接口正确返回时，出参以及出参样例：
    ```json
    {
      "success": true,
      "code": 200,
      "data": [
        {
          "taskGroupId": "tg-123",
          "teamId": "",
          "groupName": "我的任务族",
          "groupDescription": "说明",
          "groupStatus": 1,
          "userRole": 2,
          "groupAlias": "我的任务族",
          "groupColor": "#6AAEFF",
          "groupIndex": 1,
          "joinTime": "2025-12-24T12:00:00",
          "updateTime": "2025-12-25T12:00:00",
          "isPrivate": true,
          "teamName": null,
          "teamDescription": null,
          "teamAvatar": null,
          "teamStatus": null
        }
      ]
    }
    ```
  - 接口错误返回时的提示内容：
    - 401 未授权：`未能识别当前用户`
- `GET /api/taskgroups/{taskGroupId}/members`
  - 权限：任务族正常成员
  - 路径：`taskGroupId`
  - 接口正确返回时，出参以及出参样例：
    ```json
    {
      "success": true,
      "code": 200,
      "message": "查询成功",
      "data": [
        {
          "taskGroupUserRelationId": "rel-123",
          "taskGroupId": "tg-123",
          "userRole": 2,
          "userStatus": 1,
          "groupIndex": 1,
          "groupColor": "#6AAEFF",
          "groupAlias": "我的任务族",
          "joinTime": "2025-12-24T12:00:00",
          "updateTime": "2025-12-25T12:00:00",
          "userId": "user-123",
          "userName": "alice",
          "userEmail": "alice@example.com",
          "userPhone": "13800000000",
          "userSex": 1,
          "userAvatar": "http://minio:9000/ducktodo/avatars/alice.png",
          "userRemark": "Hello",
          "lastLoginTime": "2025-12-24T08:00:00"
        }
      ]
    }
    ```
  - 接口错误返回时的提示内容：
    - 401 未授权：`未能识别当前用户`
    - 400 参数错误：`缺少任务族ID`
    - 404 未找到：`任务族不存在`
    - 400 权限不足：`无权限查看该任务族成员`

## Task（任务域）
### 创建任务
- 接口请求方式与地址：POST `/api/tasks`（top.smartduck.ducktodo.controller.TaskController:120）
- 接口作用简介：创建任务，并自动建立拥有者关系，按需建立协助者与子任务。
- 接口权限限制：登录用户（私人任务族不可添加协助者）
- 接口入参：请求体 `CreateTaskRequest`
  - `taskGroupId`（必填）
  - `taskName`（必填，≥2）
  - `taskDescription`（可选）
  - `taskStatus`（可选，默认`1`未开始）
  - `taskPriority`（可选，默认`3`）
  - `startTime`（可选，默认当天）
  - `dueTime`（必填，≥当天，且`> startTime`）
  - `helperUserIdList[]`（可选，仅团队任务族允许）
  - `childTaskList[]`（可选：`{childTaskName, childTaskStatus, dueTime, assigneeUserId}`）
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "创建成功",
    "data": {
      "taskId": "t-123",
      "taskGroupId": "tg-123",
      "taskGroupName": "研发任务",
      "teamId": "team-1",
      "teamName": "研发一组",
      "taskName": "接口联调",
      "taskDescription": "说明",
      "taskStatus": 1,
      "taskPriority": 3,
      "startTime": "2025-12-25",
      "dueTime": "2025-12-31",
      "finishTime": null,
      "isOwner": 1,
      "taskHelperList": [
        {
          "taskUserRelationshipId": "rel-1",
          "userId": "u-1",
          "ifOwner": true,
          "userName": "alice",
          "userEmail": "alice@example.com",
          "userPhone": "13800000000",
          "userSex": 1,
          "userAvatar": "",
          "userRemark": ""
        }
      ],
      "childTaskList": [
        {
          "childTaskId": "ct-1",
          "taskId": "t-123",
          "childTaskName": "子任务A",
          "childTaskStatus": 1,
          "childTaskIndex": 1,
          "childTaskAssigneeId": "u-1",
          "dueTime": "2025-12-30",
          "finishTime": null,
          "createTime": "2025-12-25T12:00:00",
          "updateTime": "2025-12-25T12:00:00"
        }
      ],
      "attachments": []
    }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 404 未找到：`任务族不存在`
  - 400 参数错误：`任务名称至少 2 个字符`、`截止时间不能为空且截止时间不能小于当日`、`开始时间必须小于截止时间`
  - 400 业务限制：`私人任务族无法添加协助者`、`添加的协助者中存在非本团队的协助者`
  - 400 子任务校验：`子任务: X 名称至少 2 个字符`、`子任务: X 任务状态未在合法范围内`、`子任务: X 的截止日期不能大于主任务的截止日期`、`子任务: X 的执行者不能为空`、`子任务: X 的执行者不在协助者列表中且不为拥有者`
  - 500 服务器错误：`创建主任务记录失败`、`添加任务与拥有者关系失败`、`添加任务与协助者关系失败`、`添加子任务: X 失败`

### 添加子任务
- 接口请求方式与地址：POST `/api/tasks/children`（top.smartduck.ducktodo.controller.TaskController:323）
- 接口作用简介：为指定父任务添加一个子任务，索引自动递增。
- 接口权限限制：父任务协助者或拥有者
- 接口入参：请求体 `ChildTask`
  - `taskId`（必填，父任务ID）
  - `childTaskName`（必填，≥2）
  - `childTaskStatus`（可选，默认`1`未开始）
  - `dueTime`（必填，≤父任务`dueTime`）
  - `childTaskAssigneeId`（必填，为协助者或拥有者）
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "创建成功",
    "data": {
      "childTaskId": "ct-1",
      "taskId": "t-123",
      "childTaskName": "子任务A",
      "childTaskStatus": 1,
      "childTaskIndex": 3,
      "childTaskAssigneeId": "u-2",
      "dueTime": "2025-12-30",
      "finishTime": null,
      "createTime": "2025-12-25T12:00:00",
      "updateTime": "2025-12-25T12:00:00"
    }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少父任务ID taskId`、`子任务名称至少 2 个字符`、`子任务截止日期不能为空`
  - 404 未找到：`父任务不存在`
  - 400 权限不足：`无权添加子任务，你需要在该任务的协助者列表中或为拥有者`
  - 400 业务限制：`子任务的截止日期不能大于主任务的截止日期`、`子任务的执行者不能为空`、`子任务的执行者不在协助者列表中且不为拥有者`
  - 500 服务器错误：`创建子任务失败`

### 上传任务附件
- 接口请求方式与地址：POST `/api/tasks/{taskId}/files`（multipart/form-data）（top.smartduck.ducktodo.controller.TaskController:411）
- 接口作用简介：上传任务附件到对象存储并保存记录。
- 接口权限限制：任务协助者或拥有者
- 接口入参：路径参数 `taskId`；表单 `file`（必填）、`remark`（可选）
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "上传成功",
    "data": {
      "taskFileId": "f-1",
      "taskId": "t-123",
      "uploaderUserId": "u-1",
      "taskFileName": "设计图.png",
      "taskFilePath": "http://minio:9000/ducktodo/tasks/t-123/attachments/xxx.png",
      "taskFileType": ".png",
      "taskFileSize": 102400,
      "taskFileStatus": 1,
      "taskFileRemark": "",
      "uploadTime": "2025-12-25T12:00:00",
      "createTime": "2025-12-25T12:00:00",
      "updateTime": "2025-12-25T12:00:00"
    }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 404 未找到：`任务不存在`
  - 400 权限不足：`无权上传附件：需为该任务的协助者或拥有者`
  - 400 参数错误：`文件为空`
  - 500 服务器错误：`上传失败: ...`、`保存附件记录失败`

### 添加协助者
- 接口请求方式与地址：POST `/api/tasks/{taskId}/followers`（top.smartduck.ducktodo.controller.TaskController:501）
- 接口作用简介：为任务添加协助者关系（若已存在直接返回）。
- 接口权限限制：仅任务拥有者
- 接口入参：请求体 `TaskUserRelation`（`taskId`、`userId`）
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "添加成功",
    "data": {
      "taskUserRelationId": "rel-2",
      "taskId": "t-123",
      "userId": "u-3",
      "ifOwner": 0,
      "createTime": "2025-12-25T12:00:00",
      "updateTime": "2025-12-25T12:00:00"
    }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`需提供 taskId`、`需提供协助者 userId`
  - 404 未找到：`任务不存在`、`协助者用户不存在`
  - 400 权限不足：`仅任务拥有者可添加协助者`
  - 200 已存在：`该用户已在协助者列表中`
  - 500 服务器错误：`添加协助者失败`

### 删除任务
- 接口请求方式与地址：DELETE `/api/tasks/{taskId}`（top.smartduck.ducktodo.controller.TaskController:575）
- 接口作用简介：删除任务并级联清理附件、子任务、图谱边与节点、协助者关系与审计日志。
- 接口权限限制：仅任务拥有者
- 接口入参：路径参数 `taskId`
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "删除成功", "data": null }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少 taskId`
  - 404 未找到：`任务不存在`
  - 400 权限不足：`仅任务拥有者可删除任务`
  - 500 服务器错误：`删除任务附件文件失败: ...`、`删除任务附件失败`、`删除子任务与用户关系失败`、`删除子任务图谱边失败`、`删除子任务图谱节点失败`、`删除子任务失败`、`删除任务与用户关系失败`、`删除任务图谱边失败`、`删除任务图谱节点失败`、`删除审计日志失败`、`删除任务失败`

### 删除子任务
- 接口请求方式与地址：DELETE `/api/tasks/{taskId}/children/{childTaskId}`（top.smartduck.ducktodo.controller.TaskController:712）
- 接口作用简介：删除子任务并清理其图谱边与节点。
- 接口权限限制：父任务拥有者或协助者
- 接口入参：路径参数 `taskId`、`childTaskId`
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "删除成功", "data": null }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少 childTaskId`、`子任务缺少父任务ID`
  - 404 未找到：`子任务不存在`
  - 400 权限不足：`仅父任务拥有者或协助者可删除该子任务`
  - 500 服务器错误：`删除子任务图谱边失败`、`删除子任务图谱节点失败`、`删除子任务失败`

### 删除协助者关系
- 接口请求方式与地址：DELETE `/api/tasks/{taskId}/followers/{taskHelperId}`（top.smartduck.ducktodo.controller.TaskController:787）
- 接口作用简介：删除某协助者与该任务的关系（不可删除拥有者）。
- 接口权限限制：协助者本人或任务拥有者
- 接口入参：路径参数 `taskId`、`taskHelperId`
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "删除成功", "data": null }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少 taskHelperId`
  - 404 未找到：`协助者关系不存在`
  - 400 权限不足：`不能删除任务拥有者关系`、`仅协助者本人或任务拥有者可删除`
  - 400 业务限制：`该协助者仍被指派为子任务的执行者，请先变更或删除相关子任务`
  - 500 服务器错误：`删除协助者失败`

### 删除任务附件
- 接口请求方式与地址：DELETE `/api/tasks/{taskId}/files/{taskFileId}`（top.smartduck.ducktodo.controller.TaskController:859）
- 接口作用简介：删除对象存储中的文件并逻辑删除数据库记录。
- 接口权限限制：任务拥有者或协助者
- 接口入参：路径参数 `taskId`、`taskFileId`
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "删除成功", "data": null }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少附件ID`、`缺少任务ID`、`路径任务ID与附件所属任务不一致`
  - 404 未找到：`附件不存在`
  - 400 权限不足：`无权删除该附件：仅协助者或拥有者可删除`
  - 500 服务器错误：`删除附件文件失败: ...`、`删除附件记录失败`

### 更新任务基础信息
- 接口请求方式与地址：PUT `/api/tasks`（top.smartduck.ducktodo.controller.TaskController:945）
- 接口作用简介：按需更新任务的名称、描述、状态、优先级与时间字段，仅非空字段生效。
- 接口权限限制：任务协助者或拥有者
- 接口入参：请求体 `Task`（需包含`taskId`）
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "更新成功",
    "data": { "taskId": "t-123", "taskName": "接口联调-改", "taskStatus": 2 }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少 taskId`、`任务名称至少 2 个字符`、`截止日期不能早于开始日期`、`完成日期不能早于开始日期`
  - 404 未找到：`任务不存在`
  - 400 权限不足：`无权修改该任务`
  - 400 校验失败：`任务状态不合法`、`任务优先级不合法`
  - 500 服务器错误：`更新失败`

### 更新子任务
- 接口请求方式与地址：PUT `/api/tasks/{taskId}/children`（top.smartduck.ducktodo.controller.TaskController:1033）
- 接口作用简介：按需更新子任务，仅请求体中非空字段生效。
- 接口权限限制：父任务协助者或拥有者
- 接口入参：请求体 `ChildTask`（需包含`childTaskId`）
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "更新成功",
    "data": {
      "childTaskId": "ct-1",
      "taskId": "t-123",
      "childTaskName": "子任务A-改",
      "childTaskStatus": 2,
      "childTaskIndex": 1,
      "childTaskAssigneeId": "u-3",
      "dueTime": "2025-12-29",
      "finishTime": null
    }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少 childTaskId`、`子任务名称至少 2 个字符`
  - 404 未找到：`子任务不存在`、`被指派用户不存在`
  - 400 权限不足：`无权修改该子任务：仅协助者或拥有者可修改`
  - 400 业务限制：`子任务的截止日期不能晚于主任务的截止日期`、`被指派用户非协助者或拥有者`
  - 500 服务器错误：`更新子任务失败`

### 调整子任务排序
- 接口请求方式与地址：PUT `/api/tasks/{taskId}/children/order`（top.smartduck.ducktodo.controller.TaskController:1137）
- 接口作用简介：依据提供的有序`childTaskId`列表更新索引，从1开始。
- 接口权限限制：任务拥有者或任一子任务执行者
- 接口入参：路径参数 `taskId`；请求体 `List<String>`
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "排序更新成功",
    "data": [
      { "childTaskId": "ct-2", "childTaskIndex": 1 },
      { "childTaskId": "ct-1", "childTaskIndex": 2 }
    ]
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少任务ID`、`需提供有序的子任务ID列表`、`子任务ID列表存在空值`、`子任务ID列表存在重复项`、`子任务集合不一致：需与当前任务的子任务集合完全一致`
  - 404 未找到：`任务不存在`、`子任务不存在: {id}`
  - 400 权限不足：`仅任务拥有者或任一子任务执行者可调整排序`
  - 500 服务器错误：`子任务排序更新失败`

### 列出任务族任务
- 接口请求方式与地址：GET `/api/tasks/taskgroups/{taskGroupId}/tasks`（top.smartduck.ducktodo.controller.TaskController:1234）
- 接口作用简介：返回指定任务族下的任务摘要列表，支持筛选与排序。
- 接口权限限制：任务族正常成员
- 接口入参：路径参数 `taskGroupId`；查询参数 `taskName`、`taskStatus[]`、`taskPriority[]`、`startDueTime`、`EndDueTime`、`sortByMode(0|1)`、`relatedToMe`
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "查询成功",
    "data": [
      {
        "taskId": "t-123",
        "taskGroupId": "tg-123",
        "taskGroupName": "研发任务",
        "teamId": "team-1",
        "teamName": "研发一组",
        "taskName": "接口联调",
        "taskDescription": "说明",
        "taskStatus": 1,
        "taskPriority": 3,
        "startTime": "2025-12-25",
        "dueTime": "2025-12-31",
        "finishTime": null,
        "isOwner": 1,
        "childTaskList": []
      }
    ]
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少任务族ID`
  - 404 未找到：`任务族不存在`
  - 400 权限不足：`无权查看该任务族的任务列表`

### 分页列出任务族任务
- 接口请求方式与地址：GET `/api/tasks/taskgroups/{taskGroupId}/tasks/page`（top.smartduck.ducktodo.controller.TaskController:1384）
- 接口作用简介：与非分页列表一致，返回分页结构。
- 接口权限限制：任务族正常成员
- 接口入参：路径参数 `taskGroupId`；查询参数同上，附加 `page`（默认1）与 `size`（默认10，最大100）
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "查询成功",
    "data": {
      "records": [],
      "total": 0,
      "size": 10,
      "current": 1,
      "pages": 0
    }
  }
  ```
- 接口错误返回时的提示内容：同上

### 列出我的任务（非分页）
- 接口请求方式与地址：GET `/api/tasks/me`（top.smartduck.ducktodo.controller.TaskController:1552）
- 接口作用简介：返回与当前用户有关的任务摘要列表。
- 接口权限限制：登录用户
- 接口入参：查询参数 `taskName`、`taskStatus[]`、`taskPriority[]`、`startDueTime`、`EndDueTime`、`sortByMode(0|1)`、`taskGroupId[]`
- 接口正确返回时，出参以及出参样例：同“列出任务族任务”的列表项结构
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

### 列出我的任务（分页）
- 接口请求方式与地址：GET `/api/tasks/me/page`（top.smartduck.ducktodo.controller.TaskController:1709）
- 接口作用简介：与非分页一致，返回分页结构。
- 接口权限限制：登录用户
- 接口入参：查询参数同上，附加 `page`、`size`
- 接口正确返回时，出参以及出参样例：同“分页列出任务族任务”的分页结构
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

### 我的任务日程视图
- 接口请求方式与地址：GET `/api/tasks/me/schedule`（top.smartduck.ducktodo.controller.TaskController:1889）
- 接口作用简介：返回指定年/月范围内与我有关的任务摘要。
- 接口权限限制：登录用户
- 接口入参：查询参数 `year`（必填）、`month`（1~12，必填）、`taskGroupId[]`（可选）
- 接口正确返回时，出参以及出参样例：同“列出任务族任务”的列表项结构
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`需提供年份与月份`、`月份需在 1~12 范围内`

### 获取任务详情
- 接口请求方式与地址：GET `/api/tasks/{taskId}`（top.smartduck.ducktodo.controller.TaskController:2028）
- 接口作用简介：融合返回任务基础信息、任务族/团队名称、协助者列表、子任务列表与附件列表。
- 接口权限限制：所属任务族正常成员
- 接口入参：路径参数 `taskId`
- 接口正确返回时，出参以及出参样例：同“创建任务”的 `TaskDetailResponse` 结构（`message`为`查询成功`）
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少任务ID`
  - 404 未找到：`任务不存在`
  - 400 权限不足：`任务未关联任务族，无法校验权限`、`无权查看该任务的子任务`

### 获取子任务列表
- 接口请求方式与地址：GET `/api/tasks/{taskId}/children`（top.smartduck.ducktodo.controller.TaskController:2126）
- 接口作用简介：返回指定任务的子任务列表（索引升序、创建时间降序）。
- 接口权限限制：所属任务族正常成员
- 接口入参：路径参数 `taskId`
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "查询成功",
    "data": [
      { "childTaskId": "ct-1", "childTaskName": "子任务A", "childTaskIndex": 1 },
      { "childTaskId": "ct-2", "childTaskName": "子任务B", "childTaskIndex": 2 }
    ]
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少任务ID`
  - 404 未找到：`任务不存在`
  - 400 权限不足：`任务未关联任务族，无法校验权限`、`无权查看该任务的子任务`

### 获取任务附件列表
- 接口请求方式与地址：GET `/api/tasks/{taskId}/files`（top.smartduck.ducktodo.controller.TaskController:2179）
- 接口作用简介：返回任务的有效附件列表（状态=1，时间降序）。
- 接口权限限制：所属任务族正常成员
- 接口入参：路径参数 `taskId`
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "查询成功",
    "data": [
      { "taskFileId": "f-1", "taskFileName": "设计图.png", "taskFileType": ".png" }
    ]
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少任务ID`
  - 404 未找到：`任务不存在`
  - 403 权限不足：`任务未关联任务族，无法校验权限`、`无权查看该任务的附件`

### 获取任务审计日志
- 接口请求方式与地址：GET `/api/tasks/{taskId}/audits`（top.smartduck.ducktodo.controller.TaskController:2235）
- 接口作用简介：返回任务的审计日志列表（按创建时间降序）。
- 接口权限限制：所属任务族正常成员
- 接口入参：路径参数 `taskId`
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "查询成功",
    "data": [
      { "auditId": "a-1", "operatorId": "u-1", "actionType": "CREATE", "actionDescription": "创建任务", "createTime": "2025-12-25T12:00:00" }
    ]
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少任务ID`
  - 404 未找到：`任务不存在`
  - 403 权限不足：`任务未关联任务族，无法校验权限`、`无权查看该任务的审计日志`

## 统计（Statistics，前缀`/api/stats`）
### 加入概览（本人）
- 接口请求方式与地址：GET `/api/stats/me/overview/joined`（top.smartduck.ducktodo.controller.StatisticsController:67）
- 接口作用简介：统计我加入且状态为正常的团队与任务族数量。
- 接口权限限制：登录用户（仅本人）
- 接口入参：无
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "查询成功", "data": { "teamCount": 3, "taskGroupCount": 5 } }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

### 进行中概览（本人）
- 接口请求方式与地址：GET `/api/stats/me/overview/in_progress`（top.smartduck.ducktodo.controller.StatisticsController:97）
- 接口作用简介：统计与我相关的进行中主任务与我执行的进行中子任务数量。
- 接口权限限制：登录用户（仅本人）
- 接口入参：无
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "查询成功", "data": { "tasks": 2, "childTasks": 4 } }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

### 本周完成（本人）
- 接口请求方式与地址：GET `/api/stats/me/overview/completed/week`（top.smartduck.ducktodo.controller.StatisticsController:136）
- 接口作用简介：统计本周（周一至周日）已完成的与我相关任务数量。
- 接口权限限制：登录用户（仅本人）
- 接口入参：无
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "查询成功", "data": { "count": 5 } }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

### 本月完成（本人）
- 接口请求方式与地址：GET `/api/stats/me/overview/completed/month`（top.smartduck.ducktodo.controller.StatisticsController:162）
- 接口作用简介：统计本月已完成的与我相关任务数量。
- 接口权限限制：登录用户（仅本人）
- 接口入参：无
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "查询成功", "data": { "count": 12 } }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

### 累计完成（本人）
- 接口请求方式与地址：GET `/api/stats/me/overview/completed/total`（top.smartduck.ducktodo.controller.StatisticsController:188）
- 接口作用简介：统计历史累计完成的与我相关任务数量。
- 接口权限限制：登录用户（仅本人）
- 接口入参：无
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "查询成功", "data": { "count": 20 } }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

### 逾期概览（本人）
- 接口请求方式与地址：GET `/api/stats/me/overview/overdue`（top.smartduck.ducktodo.controller.StatisticsController:219）
- 接口作用简介：统计逾期任务总量及中度/严重分桶。
- 接口权限限制：登录用户（仅本人）
- 接口入参：无
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "查询成功", "data": { "total": 7, "moderate": 5, "severe": 2 } }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

### 负载趋势（本人）
- 接口请求方式与地址：GET `/api/stats/me/trend/load`（top.smartduck.ducktodo.controller.StatisticsController:264）
- 接口作用简介：近 N 天每日进行中主任务与子任务数量。
- 接口权限限制：登录用户（仅本人）
- 接口入参：查询参数 `days`（默认14，上限60）
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "查询成功", "data": { "items": [ { "date": "2025-12-20", "tasks": 3, "childTasks": 6 } ] } }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

### 任务趋势（本人）
- 接口请求方式与地址：GET `/api/stats/me/trend/tasks`（top.smartduck.ducktodo.controller.StatisticsController:309）
- 接口作用简介：按日统计创建与完成数量。
- 接口权限限制：登录用户（仅本人）
- 接口入参：查询参数 `range=week|month`；或 `from`、`to`
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "查询成功", "data": { "items": [ { "date": "2025-12-20", "created": 4, "completed": 2 } ] } }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

### 完成率趋势（本人）
- 接口请求方式与地址：GET `/api/stats/me/trend/completion`（top.smartduck.ducktodo.controller.StatisticsController:368）
- 接口作用简介：每日完成率（completed/created）。
- 接口权限限制：登录用户（仅本人）
- 接口入参：查询参数同“任务趋势”
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "查询成功", "data": { "items": [ { "date": "2025-12-20", "rate": 0.5, "created": 4, "completed": 2 } ] } }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

### 活跃度趋势（本人）
- 接口请求方式与地址：GET `/api/stats/me/trend/activity`（top.smartduck.ducktodo.controller.StatisticsController:422）
- 接口作用简介：基于审计日志统计每日操作事件数量。
- 接口权限限制：登录用户（仅本人）
- 接口入参：查询参数同“任务趋势”
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "查询成功", "data": { "items": [ { "date": "2025-12-20", "count": 12 } ] } }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

### 优先级分布（本人）
- 接口请求方式与地址：GET `/api/stats/me/distribution/priority`（top.smartduck.ducktodo.controller.StatisticsController:468）
- 接口作用简介：统计与我相关主任务的优先级占比。
- 接口权限限制：登录用户（仅本人）
- 接口入参：查询参数 `scope=tasks|subs`（子任务不含优先级，返回空列表）
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "查询成功", "data": { "items": [ { "priority": 3, "name": "中", "count": 10 } ] } }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

### 状态分布（本人）
- 接口请求方式与地址：GET `/api/stats/me/distribution/status`（top.smartduck.ducktodo.controller.StatisticsController:514）
- 接口作用简介：统计主任务或我执行的子任务的状态占比。
- 接口权限限制：登录用户（仅本人）
- 接口入参：查询参数 `scope=tasks|subs`
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "查询成功", "data": { "items": [ { "status": 2, "name": "进行中", "count": 8 } ] } }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

### 到期预报（本人）
- 接口请求方式与地址：GET `/api/stats/me/expiration/forecast`（top.smartduck.ducktodo.controller.StatisticsController:574）
- 接口作用简介：按桶统计未来到期数量。
- 接口权限限制：登录用户（仅本人）
- 接口入参：查询参数 `buckets=7d,3d,today`（默认）；`scope=tasks|subs`
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "查询成功", "data": { "items": [ { "bucket": "today", "count": 1 }, { "bucket": "7d", "count": 3 } ] } }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

### 逾期统计（区间，本人）
- 接口请求方式与地址：GET `/api/stats/me/overdue`（top.smartduck.ducktodo.controller.StatisticsController:636）
- 接口作用简介：统计区间内逾期任务总量与中度/严重分桶。
- 接口权限限制：登录用户（仅本人）
- 接口入参：查询参数 `from`、`to`（默认近7天）
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "查询成功", "data": { "total": 4, "moderate": 3, "severe": 1 } }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

### 平均响应时间（MTTR，本人）
- 接口请求方式与地址：GET `/api/stats/me/mttr`（top.smartduck.ducktodo.controller.StatisticsController:680）
- 接口作用简介：统计区间内任务从开始到完成的平均耗时（小时）。
- 接口权限限制：登录用户（仅本人）
- 接口入参：查询参数 `from`、`to`（默认近30天）
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "查询成功", "data": { "averageHours": 12.5, "sampleSize": 7 } }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

### 团队概览统计
- 接口请求方式与地址：GET `/api/stats/teams/{teamId}/overview`（top.smartduck.ducktodo.controller.StatisticsController:726）
- 接口作用简介：汇总团队任务总量、进行中、已完成、逾期数，附状态/优先级分布。
- 接口权限限制：团队正常成员
- 接口入参：路径参数 `teamId`
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "查询成功",
    "data": {
      "totalTasks": 20,
      "inProgressTasks": 8,
      "completedTasks": 9,
      "overdueTotal": 3,
      "statusDistribution": [ { "status": 2, "name": "进行中", "count": 8 } ],
      "priorityDistribution": [ { "priority": 3, "name": "中", "count": 12 } ]
    }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少团队ID`
  - 400 权限不足：`无权查看该团队统计`

### 团队任务分布
- 接口请求方式与地址：GET `/api/stats/teams/{teamId}/distribution`（top.smartduck.ducktodo.controller.StatisticsController:797）
- 接口作用简介：返回团队任务在状态或优先级维度的分布。
- 接口权限限制：团队正常成员
- 接口入参：路径参数 `teamId`；查询参数 `by=status|priority`
- 接口正确返回时，出参以及出参样例（`by=status`）：
  ```json
  { "success": true, "code": 200, "message": "查询成功", "data": { "items": [ { "status": 1, "name": "未开始", "count": 5 } ] } }
  ```
- 接口正确返回时，出参以及出参样例（`by=priority`）：
  ```json
  { "success": true, "code": 200, "message": "查询成功", "data": { "items": [ { "priority": 3, "name": "中", "count": 12 } ] } }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少团队ID`
  - 400 权限不足：`无权查看该团队统计`

### 团队成员负载统计
- 接口请求方式与地址：GET `/api/stats/teams/{teamId}/workload`（top.smartduck.ducktodo.controller.StatisticsController:861）
- 接口作用简介：统计团队成员在进行中或全部任务上的负载。
- 接口权限限制：团队正常成员
- 接口入参：路径参数 `teamId`；查询参数 `scope=in_progress|all`
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "查询成功", "data": { "items": [ { "userId": "u-1", "userName": "alice", "inProgress": 3, "total": 7 } ] } }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少团队ID`
  - 400 权限不足：`无权查看该团队统计`

### 团队燃尽图
- 接口请求方式与地址：GET `/api/stats/teams/{teamId}/burndown`（top.smartduck.ducktodo.controller.StatisticsController:914）
- 接口作用简介：按日返回剩余与新增完成数量。
- 接口权限限制：团队正常成员
- 接口入参：路径参数 `teamId`；查询参数 `from`、`to`（默认近7天）
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "查询成功", "data": { "items": [ { "date": "2025-12-20", "remaining": 10, "completed": 2 } ] } }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少团队ID`
  - 400 权限不足：`无权查看该团队统计`

### 团队逾期统计
- 接口请求方式与地址：GET `/api/stats/teams/{teamId}/overdue`（top.smartduck.ducktodo.controller.StatisticsController:967）
- 接口作用简介：统计区间内逾期任务总量，并按成员与任务族聚合分布。
- 接口权限限制：团队正常成员
- 接口入参：路径参数 `teamId`；查询参数 `from`、`to`（默认近30天）
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "查询成功",
    "data": {
      "total": 5,
      "byMember": [ { "userId": "u-1", "userName": "alice", "count": 2 } ],
      "byTaskGroup": [ { "taskGroupId": "tg-1", "taskGroupName": "研发", "count": 3 } ]
    }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少团队ID`
  - 400 权限不足：`无权查看该团队统计`

### 团队活跃度趋势
- 接口请求方式与地址：GET `/api/stats/teams/{teamId}/trend/activity`（top.smartduck.ducktodo.controller.StatisticsController:1036）
- 接口作用简介：基于审计日志统计团队每日操作事件数量。
- 接口权限限制：团队正常成员
- 接口入参：路径参数 `teamId`；查询参数 `range=week|month`
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "查询成功", "data": { "items": [ { "date": "2025-12-20", "count": 15 } ] } }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少团队ID`
  - 400 权限不足：`无权查看该团队统计`

### 团队图谱摘要
- 接口请求方式与地址：GET `/api/stats/teams/{teamId}/graph/summary`（top.smartduck.ducktodo.controller.StatisticsController:1089）
- 接口作用简介：统计团队任务图谱的节点/边数量与类型分布。
- 接口权限限制：团队正常成员
- 接口入参：路径参数 `teamId`
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "查询成功",
    "data": {
      "nodeCount": 42,
      "edgeCount": 80,
      "nodeTypes": [ { "type": "task", "count": 30 } ],
      "edgeTypes": [ { "type": "depends_on", "count": 20 } ]
    }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 400 参数错误：`缺少团队ID`
  - 400 权限不足：`无权查看该团队统计`

## 外部配置
### 钉钉机器人配置（前缀`/api/dingtalk-robot-configs`）
- 接口请求方式与地址：GET `/api/dingtalk-robot-configs`（top.smartduck.ducktodo.controller.DingTalkConfigController:59）
- 接口作用简介：获取当前用户的钉钉机器人配置列表。
- 接口权限限制：登录用户（仅本人）
- 接口入参：无
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "查询成功",
    "data": [
      {
        "userDingtalkRobotId": "robot-123",
        "userId": "u-1",
        "robotName": "通知机器人",
        "dingtalkRobotToken": "token_xxx",
        "dingtalkRobotSecret": "secret_xxx",
        "dingtalkRobotKeyword": "ducktodo",
        "isDelete": 0,
        "createTime": "2025-12-25T12:00:00",
        "updateTime": "2025-12-25T12:00:00"
      }
    ]
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

- 接口请求方式与地址：POST `/api/dingtalk-robot-configs`（top.smartduck.ducktodo.controller.DingTalkConfigController:76）
- 接口作用简介：添加当前用户的钉钉机器人配置。
- 接口权限限制：登录用户（仅本人）
- 接口入参：请求体 `UserDingtalkRobot`（按需读取并去空格：`robotName`、`dingtalkRobotToken`、`dingtalkRobotSecret`、`dingtalkRobotKeyword`）
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "创建成功",
    "data": {
      "userDingtalkRobotId": "robot-123",
      "userId": "u-1",
      "robotName": "通知机器人",
      "dingtalkRobotToken": "token_xxx",
      "dingtalkRobotSecret": "secret_xxx",
      "dingtalkRobotKeyword": "ducktodo",
      "isDelete": 0,
      "createTime": "2025-12-25T12:00:00",
      "updateTime": "2025-12-25T12:00:00"
    }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 500 服务器错误：`创建失败`

- 接口请求方式与地址：PUT `/api/dingtalk-robot-configs/{robotId}`（top.smartduck.ducktodo.controller.DingTalkConfigController:102）
- 接口作用简介：更改当前用户的钉钉机器人配置（仅更新请求体中提供的字段）。
- 接口权限限制：登录用户（仅本人且配置归属本人）
- 接口入参：
  - 路径参数：`robotId`
  - 请求体：`UserDingtalkRobot`（按需读取并去空格：`robotName`、`dingtalkRobotToken`、`dingtalkRobotSecret`、`dingtalkRobotKeyword`）
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "更新成功",
    "data": {
      "userDingtalkRobotId": "robot-123",
      "userId": "u-1",
      "robotName": "通知机器人-改",
      "dingtalkRobotToken": "token_xxx",
      "dingtalkRobotSecret": "secret_xxx",
      "dingtalkRobotKeyword": "ducktodo",
      "isDelete": 0,
      "createTime": "2025-12-24T12:00:00",
      "updateTime": "2025-12-25T12:05:00"
    }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 404 未找到：`配置不存在`
  - 400 权限不足：`无权操作该配置`
  - 500 服务器错误：`更新失败`

- 接口请求方式与地址：DELETE `/api/dingtalk-robot-configs/{robotId}`（top.smartduck.ducktodo.controller.DingTalkConfigController:132）
- 接口作用简介：删除当前用户的钉钉机器人配置。
- 接口权限限制：登录用户（仅本人且配置归属本人）
- 接口入参：路径参数 `robotId`
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "删除成功", "data": true }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 404 未找到：`配置不存在`
  - 400 权限不足：`无权操作该配置`
  - 500 服务器错误：`删除失败`

- 接口请求方式与地址：GET `/api/dingtalk-robot-configs/{robotId}`（top.smartduck.ducktodo.controller.DingTalkConfigController:151）
- 接口作用简介：基于配置ID查询单个钉钉机器人配置（需本人且归属本人）。
- 接口权限限制：登录用户（仅本人且配置归属本人）
- 接口入参：路径参数 `robotId`
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "查询成功",
    "data": {
      "userDingtalkRobotId": "robot-123",
      "userId": "u-1",
      "robotName": "通知机器人",
      "dingtalkRobotToken": "token_xxx",
      "dingtalkRobotSecret": "secret_xxx",
      "dingtalkRobotKeyword": "ducktodo",
      "isDelete": 0,
      "createTime": "2025-12-24T12:00:00",
      "updateTime": "2025-12-25T12:05:00"
    }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 404 未找到：`配置不存在`
  - 400 权限不足：`无权访问该配置`

### LLM 配置（前缀`/api/llm-configs`）
- 接口请求方式与地址：GET `/api/llm-configs`（top.smartduck.ducktodo.controller.LlmConfigController:60）
- 接口作用简介：获取当前用户的 LLM 配置列表。
- 接口权限限制：登录用户（仅本人）
- 接口入参：无
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "查询成功",
    "data": [
      {
        "userLlmConfigId": "llm-123",
        "userId": "u-1",
        "llmProvider": "openai",
        "llmApiKey": "sk_xxx",
        "llmApiUrl": "https://api.openai.com",
        "llmModelName": "gpt-4o-mini",
        "llmModelTemperature": 0.7,
        "llmModelThinking": 1,
        "isDelete": 0,
        "createTime": "2025-12-24T12:00:00",
        "updateTime": "2025-12-25T12:05:00"
      }
    ]
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`

- 接口请求方式与地址：POST `/api/llm-configs`（top.smartduck.ducktodo.controller.LlmConfigController:77）
- 接口作用简介：添加当前用户的 LLM 配置。
- 接口权限限制：登录用户（仅本人）
- 接口入参：请求体 `UserLlmConfig`（按需读取并去空格：`llmProvider`、`llmApiKey`、`llmApiUrl`、`llmModelName`；若`userLlmConfigId`缺失则自动生成）
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "创建成功",
    "data": {
      "userLlmConfigId": "llm-123",
      "userId": "u-1",
      "llmProvider": "openai",
      "llmApiKey": "sk_xxx",
      "llmApiUrl": "https://api.openai.com",
      "llmModelName": "gpt-4o-mini",
      "llmModelTemperature": 0.7,
      "llmModelThinking": 1,
      "isDelete": 0,
      "createTime": "2025-12-24T12:00:00",
      "updateTime": "2025-12-25T12:05:00"
    }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 500 服务器错误：`创建失败`

- 接口请求方式与地址：PUT `/api/llm-configs/{configId}`（top.smartduck.ducktodo.controller.LlmConfigController:106）
- 接口作用简介：更改当前用户的 LLM 配置（仅更新请求体中提供的字段）。
- 接口权限限制：登录用户（仅本人且配置归属本人）
- 接口入参：
  - 路径参数：`configId`
  - 请求体：`UserLlmConfig`（按需读取并去空格：`llmProvider`、`llmApiKey`、`llmApiUrl`、`llmModelName`、`llmModelTemperature`、`llmModelThinking`）
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "更新成功",
    "data": {
      "userLlmConfigId": "llm-123",
      "userId": "u-1",
      "llmProvider": "openai",
      "llmApiKey": "sk_xxx",
      "llmApiUrl": "https://api.openai.com",
      "llmModelName": "gpt-4o-mini",
      "llmModelTemperature": 0.6,
      "llmModelThinking": 0,
      "isDelete": 0,
      "createTime": "2025-12-24T12:00:00",
      "updateTime": "2025-12-25T12:10:00"
    }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 404 未找到：`配置不存在`
  - 400 权限不足：`无权操作该配置`
  - 500 服务器错误：`更新失败`

- 接口请求方式与地址：DELETE `/api/llm-configs/{configId}`（top.smartduck.ducktodo.controller.LlmConfigController:138）
- 接口作用简介：删除当前用户的 LLM 配置。
- 接口权限限制：登录用户（仅本人且配置归属本人）
- 接口入参：路径参数 `configId`
- 接口正确返回时，出参以及出参样例：
  ```json
  { "success": true, "code": 200, "message": "删除成功", "data": true }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 404 未找到：`配置不存在`
  - 400 权限不足：`无权操作该配置`
  - 500 服务器错误：`删除失败`

- 接口请求方式与地址：GET `/api/llm-configs/{configId}`（top.smartduck.ducktodo.controller.LlmConfigController:157）
- 接口作用简介：基于配置ID查询单个 LLM 配置（需本人且归属本人）。
- 接口权限限制：登录用户（仅本人且配置归属本人）
- 接口入参：路径参数 `configId`
- 接口正确返回时，出参以及出参样例：
  ```json
  {
    "success": true,
    "code": 200,
    "message": "查询成功",
    "data": {
      "userLlmConfigId": "llm-123",
      "userId": "u-1",
      "llmProvider": "openai",
      "llmApiKey": "sk_xxx",
      "llmApiUrl": "https://api.openai.com",
      "llmModelName": "gpt-4o-mini",
      "llmModelTemperature": 0.7,
      "llmModelThinking": 1,
      "isDelete": 0,
      "createTime": "2025-12-24T12:00:00",
      "updateTime": "2025-12-25T12:05:00"
    }
  }
  ```
- 接口错误返回时的提示内容：
  - 401 未授权：`未能识别当前用户`
  - 404 未找到：`配置不存在`
  - 400 权限不足：`无权访问该配置`

## 备注与错误约定
- 认证失败：`401`
- 权限不足：`400`（权限相关错误统一使用400状态码，禁止使用403）
- 资源不存在：`404`
- 参数不合法：`400`
- 服务器错误：`500`

