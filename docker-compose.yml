version: "3.8"

services:
  ducktodo:
    image: ducktodo:latest
    container_name: ducktodo
    env_file:
      - ./.env
    environment:
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-prod}
      MYSQL_URL: ${MYSQL_URL}
      MYSQL_PORT: ${MYSQL_PORT:-3306}
      MYSQL_DATABASE: ${MYSQL_DATABASE:-DuckTodo}
      MYSQL_USERNAME: ${MYSQL_USERNAME}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
      MINIO_ENDPOINT: ${MINIO_ENDPOINT}
      MINIO_ACCESS_KEY: ${MINIO_ACCESS_KEY}
      MINIO_SECRET_KEY: ${MINIO_SECRET_KEY}
      MINIO_BUCKET: ${MINIO_BUCKET:-ducktodo}
      MINIO_ENSURE_BUCKET: ${MINIO_ENSURE_BUCKET:-false}
      JWT_SECRET: ${JWT_SECRET}
      JWT_EXPIRE_SECONDS: ${JWT_EXPIRE_SECONDS:-86400}
      API_PREFIX: ${API_PREFIX:-/api}
      AI_BACKEND_URL: ${AI_BACKEND_URL:-http://localhost:8082}
      SERVER_HOST: ${SERVER_HOST:-0.0.0.0}
      SERVER_PORT: ${SERVER_PORT:-8082}
    ports:
      - "${HOST_HTTP_PORT:-8080}:${NGINX_PORT:-80}"
      - "${HOST_API_PORT:-8081}:${SERVER_PORT:-8080}"
      - "${HOST_AI_BACKEND_PORT:-8082}:8082"
    restart: unless-stopped
