# nginx.conf
worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout  65;

    # 开启 gzip 压缩（优化前端加载速度）
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    server {
        listen       80;  # 监听 80 端口（若域名用 HTTPS，需加 443 端口配置）
        server_name  localhost;  # 生产环境可改为你的域名（如 your-domain.com）

        # 前端静态文件访问（域名根路径 → Vue 静态文件）
        location / {
            root   /usr/share/nginx/html;
            index  index.html index.htm;
            try_files $uri $uri/ /index.html;  # 解决 Vue 路由刷新 404
            # 缓存静态文件（优化性能）
            expires 1d;
        }

        # 后端接口代理（域名/api → 容器内后端服务）
        location /api/ {
            proxy_pass http://localhost:8080/api/;  # 代理到后端 8080 端口（去掉 /api 前缀）
            proxy_set_header Host $host;  # 传递域名到后端（后端可获取真实域名）
            proxy_set_header X-Real-IP $remote_addr;  # 传递真实客户端 IP
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;  # 传递协议（http/https）
            proxy_connect_timeout 60s;  # 连接超时时间
            proxy_read_timeout 60s;     # 读取超时时间
        }

        # 错误页面配置
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }

    # 可选：HTTPS 配置（若域名已申请 SSL 证书）
    # server {
    #     listen       443 ssl;
    #     server_name  your-domain.com;  # 你的域名

    #     # SSL 证书配置（需将证书文件挂载到容器内）
    #     ssl_certificate      /etc/nginx/ssl/your-domain.crt;  # 证书公钥路径
    #     ssl_certificate_key  /etc/nginx/ssl/your-domain.key;  # 证书私钥路径

    #     ssl_session_cache    shared:SSL:1m;
    #     ssl_session_timeout  5m;

    #     ssl_ciphers  HIGH:!aNULL:!MD5;
    #     ssl_prefer_server_ciphers  on;

    #     # 前端静态文件（同 80 端口配置）
    #     location / {
    #         root   /usr/share/nginx/html;
    #         index  index.html index.htm;
    #         try_files $uri $uri/ /index.html;
    #         expires 1d;
    #     }

    #     # 后端接口代理（同 80 端口配置）
    #     location /api/ {
    #         proxy_pass http://localhost:8080/;
    #         proxy_set_header Host $host;
    #         proxy_set_header X-Real-IP $remote_addr;
    #         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #         proxy_set_header X-Forwarded-Proto $scheme;  # 传递 HTTPS 协议
    #     }
    # }
}